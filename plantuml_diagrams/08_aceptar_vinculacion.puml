@startuml
!theme plain
skinparam backgroundColor #FFFFFF
skinparam activityBackgroundColor #FFF9C4
skinparam activityBorderColor #F9A825
skinparam activityFontSize 12
skinparam arrowColor #F9A825

title Flujo 8: Aceptar Solicitud de Vinculaci√≥n - Dashboard Web (M√©dico)

start

:Paciente usa c√≥digo vinculaci√≥n;
:Sistema registra solicitud;

partition "Notificaci√≥n al M√©dico" {
  :Enviar notificaci√≥n en dashboard;
  
  :Badge num√©rico en campana:
  "üîî (1)";
  
  :Banner en dashboard:
  "Nueva solicitud de vinculaci√≥n
  de [Nombre Paciente]";
  
  if (¬øEmail notificaciones activo?) then (S√≠)
    :Enviar email:
    "Asunto: Nueva solicitud MediMind
    
    Dr./Dra. [Nombre],
    
    Tienes una nueva solicitud de
    vinculaci√≥n de [Nombre Paciente].
    
    Ingresa a tu dashboard para
    revisar y aceptar.";
  endif
}

:M√©dico abre dashboard;
:Click en notificaci√≥n;

partition "Modal Solicitud" {
  :Abrir modal centrado;
  
  :T√≠tulo:
  "Nueva Solicitud de Vinculaci√≥n";
  
  :Tarjeta del solicitante;
  :Mostrar informaci√≥n:
  - Nombre completo
  - Edad
  - G√©nero
  - Fecha de solicitud
  - C√≥digo usado;
  
  if (¬øPaciente agreg√≥ condiciones?) then (S√≠)
    :Mostrar lista:
    "Condiciones m√©dicas declaradas:
    - [Lista de condiciones]";
  endif
  
  if (¬øPaciente agreg√≥ nota?) then (S√≠)
    :Mostrar nota:
    "Mensaje del paciente:
    [Texto de la nota]";
  endif
  
  :Pregunta principal:
  "¬øReconoces a este paciente?";
}

partition "Decisi√≥n del M√©dico" {
  if (¬øDecisi√≥n?) then (Aceptar)
    :Click bot√≥n "Aceptar Vinculaci√≥n";
    
    :Modal confirmaci√≥n:
    "Al aceptar esta vinculaci√≥n:
    
    ‚úì Podr√°s monitorear adherencia
    ‚úì Recibir√°s alertas autom√°ticas
    ‚úì Paciente ser√° notificado
    
    El paciente podr√°:
    ‚úì Pausar compartici√≥n cuando quiera
    ‚úì Desvincular en cualquier momento
    
    T√∫ NO podr√°s:
    ‚úó Modificar sus medicamentos
    ‚úó Acceder a datos sin consentimiento
    
    ¬øConfirmar vinculaci√≥n?";
    
    if (¬øConfirma aceptaci√≥n?) then (S√≠)
      :Procesar vinculaci√≥n;
      
      :Acciones del sistema:
      1. Crear registro vinculaci√≥n
      2. Activar sincronizaci√≥n autom√°tica
      3. Generar ID √∫nico vinculaci√≥n
      4. Actualizar estado c√≥digo (usado);
      
      :Notificar al paciente;
      
      :Push notification al paciente:
      "üéâ ¬°Excelente noticia!
      
      Dr./Dra. [Nombre] acept√≥
      tu solicitud de vinculaci√≥n.
      
      Ya puedes compartir tu
      adherencia con tu m√©dico.";
      
      if (¬øPaciente tiene email?) then (S√≠)
        :Email al paciente:
        "Vinculaci√≥n exitosa con
        Dr./Dra. [Nombre]
        
        Desde ahora tu m√©dico
        puede monitorear tu adherencia.";
      endif
      
      :Dashboard actualizado;
      
      :Modal √©xito:
      "‚úì Vinculaci√≥n exitosa
      
      [Nombre Paciente] ya aparece
      en tu lista de pacientes.";
      
      :Agregar a lista pacientes;
      :Incrementar contador:
      "Total pacientes: [N+1]";
      
      :Ofrecer opciones:
      - Ver perfil del paciente
      - Cerrar y continuar;
      
      if (¬øVer perfil?) then (S√≠)
        :Navegar a p√°gina detalle;
        :Mostrar datos iniciales:
        - Informaci√≥n b√°sica
        - Medicamentos actuales
        - Adherencia desde vinculaci√≥n;
      endif
      
    else (Cancela confirmaci√≥n)
      :Volver a modal solicitud;
      stop
    endif
    
  elseif (Rechazar) then
    :Click bot√≥n "Rechazar";
    
    :Modal confirmaci√≥n rechazo:
    "¬øSeguro que quieres rechazar
    esta solicitud?
    
    El paciente ser√° notificado.";
    
    :Checkbox opcional:
    "‚òê Agregar raz√≥n del rechazo
    (el paciente la ver√°)";
    
    if (¬øAgregar raz√≥n?) then (S√≠)
      :Campo de texto;
      :M√©dico escribe raz√≥n:
      "Ejemplo:
      - No te tengo registrado/a
      - Verifica que el c√≥digo sea correcto
      - Contacta a la cl√≠nica
      - Etc.";
    endif
    
    if (¬øConfirma rechazo?) then (S√≠)
      :Procesar rechazo;
      
      :Acciones del sistema:
      1. Marcar solicitud como rechazada
      2. Registrar timestamp
      3. Guardar raz√≥n (si existe);
      
      :Notificar al paciente;
      
      :Push notification al paciente:
      "Dr./Dra. [Nombre] no pudo
      aceptar tu solicitud de vinculaci√≥n.";
      
      if (¬øM√©dico dej√≥ raz√≥n?) then (S√≠)
        :Mostrar raz√≥n en notificaci√≥n:
        "Raz√≥n: [Texto del m√©dico]";
      endif
      
      :Email al paciente:
      "Solicitud de vinculaci√≥n
      no aceptada
      
      Te recomendamos:
      - Verificar datos con tu m√©dico
      - Solicitar nuevo c√≥digo
      - Contactar a la cl√≠nica";
      
      :Eliminar solicitud de lista;
      
      :Modal confirmaci√≥n:
      "‚úì Solicitud rechazada
      
      El paciente ha sido notificado.";
      
    else (Cancela rechazo)
      :Volver a modal solicitud;
      stop
    endif
    
  else (Necesita m√°s info)
    :Click "Solicitar informaci√≥n";
    
    :Modal mensaje al paciente:
    "Necesito m√°s informaci√≥n
    para verificar tu identidad";
    
    :Campo de texto;
    :M√©dico escribe qu√© necesita:
    "Ejemplo:
    - ¬øCu√°ndo fue tu √∫ltima consulta?
    - ¬øRecuerdas el diagn√≥stico?
    - ¬øPodr√≠as compartir tu # historia cl√≠nica?";
    
    if (¬øEnviar solicitud?) then (S√≠)
      :Enviar mensaje al paciente;
      
      :Notificaci√≥n al paciente:
      "Dr./Dra. [Nombre] necesita
      m√°s informaci√≥n antes de
      aceptar tu solicitud.
      
      Mensaje:
      [Texto del m√©dico]
      
      Por favor responde desde
      tu app.";
      
      :Marcar solicitud como:
      "Pendiente de informaci√≥n";
      
      :Agregar a lista "Solicitudes pendientes";
      
      :Establecer l√≠mite tiempo;
      if (¬øPaciente responde en 7 d√≠as?) then (No)
        :Solicitud expira;
        :Notificar al paciente:
        "Tu solicitud expir√≥ por
        falta de respuesta.
        Genera una nueva.";
        
        :Eliminar solicitud;
        stop
      else (S√≠ responde)
        :Notificar al m√©dico:
        "Paciente respondi√≥ tu
        solicitud de informaci√≥n";
        
        :Actualizar modal con respuesta;
        :M√©dico puede entonces:
        Aceptar o Rechazar;
      endif
    endif
  endif
}

partition "Gesti√≥n de Solicitudes M√∫ltiples" {
  :Lista de solicitudes pendientes;
  
  :Tabla ordenada por fecha;
  :Columnas:
  | Paciente | Fecha | Estado | Acciones |;
  
  :Filtros disponibles:
  - Nuevas (sin revisar)
  - Pendientes de info
  - Por revisar
  - Todas;
  
  :Contador en sidebar:
  "Solicitudes pendientes (N)";
  
  :Procesamiento batch;
  if (¬øM√∫ltiples solicitudes?) then (S√≠)
    :Opci√≥n "Revisar siguiente";
    :Teclado shortcut:
    - Enter = Aceptar
    - R = Rechazar
    - I = Solicitar info
    - ‚Üí = Siguiente;
    
    :Facilitar revisi√≥n r√°pida;
  endif
}

partition "Control y Auditor√≠a" {
  :Historial de solicitudes;
  
  :Pesta√±a "Historial";
  :Ver todas las solicitudes:
  - Aceptadas (fecha, paciente)
  - Rechazadas (fecha, raz√≥n)
  - Expiradas (fecha);
  
  :B√∫squeda por:
  - Nombre paciente
  - Rango de fechas
  - Estado;
  
  :Exportar historial como PDF/Excel;
  
  note right
    Para auditor√≠a institucional
    y cumplimiento regulatorio
  end note
}

:Proceso completado;
:Dashboard actualizado;

stop

@enduml
